ICan={},function(a,b,c){function d(a,b){return function(c){var d=_.find(c.iCanBelongTo,f(a));d&&(c[d.name]=b)}}function e(a){return function(b){var d=_.find(b.iCanBelongTo,f(a));d&&(b[d.name]=c)}}function f(a){return function(b){return b.relatedClass===a.containingClass}}ICan.HasManyRelation=function(a){this.iCanHasRelation=!0,this.collectionClass=a},_.extend(ICan.HasManyRelation.prototype,{initialize:function(a){var b=a.attributes[this.name];this.model=a,this.setCollectionClass(),this.coll=new this.collectionClass(b),this.addUpdaters(),this.setCollection()},addUpdaters:function(){this.coll.on("add",d(this,this.model)),this.coll.on("remove",e(this))},setCollectionClass:function(){typeof this.collectionClass=="string"&&(this.collectionClass=b[this.collectionClass])},setCollection:function(){delete this.model.attributes[this.name],this.model[this.name]=this.coll}}),ICan.BelongsToRelation=function(a){this.iCanHasRelation=!0,this.relatedClass=a},_.extend(ICan.BelongsToRelation.prototype,{initialize:function(a){a.iCanBelongTo||(a.iCanBelongTo=[]),a.iCanBelongTo.push(this),a[this.name]=null,this.setRelatedClass()},setRelatedClass:function(){typeof this.relatedClass=="string"&&(this.relatedClass=b[this.relatedClass])}})}(jQuery,this,undefined),function(a,b,c){function d(a){var b=a.constructor.prototype,d=b.iCanHasRelations;return d===c&&(d=e(a),b.iCanHasRelations=d,b.serializeGraph=f),d}function e(a){var b=a.constructor,c=[],d=null;for(var e in a)d=a[e],d.iCanHasRelation&&(delete a[e],d.name=e,d.containingClass=b,c.push(d));return c}function f(){var a=this.toJSON(),b=this.iCanHasRelations;for(var c=0;c<b.length;c+=1)if(b[c]instanceof ICan.HasManyRelation){var d=b[c].name;a[d]=this[d].map(function(a){return a.serializeGraph()})}return a}_.extend(ICan,{haveRelationsOn:function(a){var b=d(a);for(var c=0;c<b.length;c+=1)b[c].initialize(a)},hasMany:function(a){return new ICan.HasManyRelation(a)},belongsTo:function(a){return new ICan.BelongsToRelation(a)}})}(jQuery,this,undefined);